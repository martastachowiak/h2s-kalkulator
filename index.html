<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Kalkulator szacowanego stężenia H₂S w powietrzu w studni rozprężnej za rurociągiem tłocznym</title>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <style>
    :root { --ink:#2c3e50; --muted:#6b7b8c; --panel:#f4f7fb; --accent:#2c3e50; }
    body { font-family:"Segoe UI",system-ui,-apple-system,Arial,sans-serif; color:var(--ink); background:#f7f9fc; margin:0; padding:24px; }
    .wrap { max-width:1100px; margin:0 auto; position:relative; }
    h1 { text-align:center; margin:6px 0 4px; }
    .formula { text-align:center; font-size:22px; margin-bottom:10px; }
    .grid { display:grid; grid-template-columns:360px 1fr; gap:20px; align-items:stretch; }
    .card { background:#fff; border-radius:12px; padding:16px 18px; box-shadow:0 4px 12px rgba(0,0,0,.06); border:1px solid #e7eef7; }
    .params h3 { margin:0 0 8px; font-size:16px; }
    .params ul { margin:0; padding-left:18px; line-height:1.6; }
    label { display:block; font-weight:600; margin:12px 0 6px; }
    input[type=number]{ width:75%; padding:8px 10px; border:1px solid #cfd9e6; border-radius:8px; font-size:15px; background:#fff; }
    button{ background:var(--accent); color:#fff; border:none; padding:10px 14px; border-radius:8px; font-weight:600; cursor:pointer; margin-top:10px; }
    button:hover{ filter:brightness(1.05); }
    .hint{ font-size:13px; color:var(--muted); margin-top:40px; text-align:center; }
    .result{ margin-top:20px; font-weight:600; font-size:16px; text-align:center; }
    .result-value {
      display:block;
      margin-top:6px;
      transition: all 0.3s ease;
      text-align:center;
    }
    .result-value.big {
      font-size:32px;
      font-weight:700;
      color:#000;
    }
    .result-value.small {
      font-size:15px;
      color:#a33;
      font-weight:500;
    }
    .title-bar{ text-align:center; margin:6px 0 10px; font-weight:700; font-size:18px; }
    .toolbar{ text-align:center; margin-bottom:8px; }
    .footer {
      position: fixed;
      right: 16px;
      bottom: 12px;
      text-align: right;
      font-size: 12px;
      color: #465a6e;
      background: rgba(255,255,255,0.85);
      border: 1px solid #e2e9f2;
      border-radius: 8px;
      padding: 8px 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
	 body { overflow-x: hidden; }          /* usuń poziomy scroll */
	input[type=number]{ box-sizing: border-box; font-size:16px; } /* brak auto-zoomu iOS */
	.form-group { width:75%; max-width:420px; }                    /* 75% szerokości karty */
	#cnt { height:620px; }                                        /* wysokość startowa mapy (desktop) */
	 
	/* MOBILE */
	@media (max-width: 768px) {
	  body { padding: 16px; }
	  .grid { grid-template-columns: 1fr; gap: 14px; }
	  .card { padding: 12px 14px; }              /* mniejsze karty */
	  #plot.card { padding: 8px; }               /* ciaśniejsza karta mapy */
	  .form-group { width: 75%; max-width: 340px; } /* pola nie będą na całą szerokość */
	  input[type=number] { width: 75%; }         /* utrzymujemy proporcję 75% */
	  .formula { font-size: 18px; }
	  .title-bar { font-size: 16px; }
	  #cnt { height: min(92vw, 520px); min-height: 340px; } /* mapa jako kwadrat */
	}

  </style>
</head>
<body>
  <div class="wrap">
    <h1>Kalkulator stężenia H₂S</h1>
    <div class="formula">
      <span id="eq">\( f(t,T)=a\cdot t\cdot\left(\dfrac{T-T_{\min}}{T_{\max}-T_{\min}}\right)^{\frac{w}{t}} \)</span>
    </div>

    <div class="grid">
      <div class="card">
        <div class="params">
          <h3>Parametry modelu:</h3>
          <ul>
            <li><b>T<sub>min</sub></b> = 10&nbsp;°C</li>
            <li><b>T<sub>max</sub></b> = 25&nbsp;°C</li>
            <li><b>a</b> = 40</li>
            <li><b>w</b> = 8</li>
            <li><b>Zakres stosowalności:</b>
              <div style="margin-left:10px">
                t = 3–24 h<br>
                T = 10–25 °C
              </div>
            </li>
          </ul>
        </div>

        <br>
		<div class="form-group">
		  <label for="t">Czas przetrzymania ścieków <b>t</b> [h] (3–24):</label>
		  <input id="t" type="number" step="0.1" min="3" max="24" placeholder="np. 6">
		</div>
		
		<div class="form-group">
		  <label for="T">Temperatura ścieków <b>T</b> [°C] (10–25):</label>
		  <input id="T" type="number" step="0.1" min="10" max="25" placeholder="np. 20">
		</div>

		  <button id="btn">Oblicz i zaznacz punkt</button>

        <div class="result">
          Przewidywane stężenie H₂S:
          <span class="result-value" id="wynik">—</span>
        </div>

        <div class="hint">Punkt na mapie pokazuje parę (T, t).<br>Kolor tła obrazuje wartość modelu.</div>
      </div>

      <div>
        <div class="title-bar">Mapa konturowa stężenia H₂S</div>
        <div class="toolbar">
          <button id="dl">⬇️ Pobierz mapę jako PNG</button>
          <button id="resetViewBtn" style="margin-left:8px">↺ Resetuj widok</button>
        </div>
        <div id="plot" class="card" style="padding:10px;">
          <div id="cnt"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    Autorka: <b>Marta Stachowiak</b><br/>
    Kontakt: <a href="mailto:martamstachowiak@gmail.com">martamstachowiak@gmail.com</a>
  </div>

  <!-- MathJax -->
  <script> window.MathJax = { tex:{ inlineMath:[['\\(','\\)']] } }; </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <script>
    const Tmin = 10, Tmax = 25, a = 40, w = 8;

    function model(t, T) {
      const ratio = (T - Tmin) / (Tmax - Tmin);
      if (ratio < 0) return 0;
      const val = a * t * Math.pow(ratio, w / t);
      return Math.max(0, val);
    }

    const tVals = Array.from({length: 85}, (_,i)=> 3 + i*(21/84));
    const TVals = Array.from({length:121}, (_,i)=>10 + i*(15/120));
    const Z = tVals.map(t => TVals.map(T => model(t,T)));

    const colorscale = [
      [0.00, 'rgb(0,80,40)'],
      [0.25, 'rgb(40,140,70)'],
      [0.50, 'rgb(200,200,60)'],
      [0.75, 'rgb(230,140,40)'],
      [1.00, 'rgb(170,0,0)']
    ];

    const contour = {
      x: TVals, y: tVals, z: Z,
      type: 'contour',
      contours: { coloring: 'heatmap', showlines: true, linewidth: 0.7 },
      colorscale: colorscale,
      colorbar: { title: {text: 'Stężenie H₂S [ppm]', side: 'right'}, thickness: 18 },
      hovertemplate: 'Temperatura T: %{x:.1f} °C<br>Czas t: %{y:.1f} h<br>H₂S: %{z:.2f} ppm<extra></extra>'
    };

    const pointTrace = {
      x: [], y: [],
      mode: 'markers+text', type: 'scatter',
      marker: { size: 10, color: 'rgb(200,0,0)' },
      text: [], textposition: 'bottom right',
      textfont: { color: '#000', size: 14 },
      hovertemplate: 'Temperatura T: %{x:.1f} °C<br>Czas t: %{y:.1f} h<br>H₂S: %{text}<extra></extra>',
      showlegend: false
    };

    const layout = {
      xaxis: { title: 'Temperatura T [°C]', range:[10,25], autorange:false },
      yaxis: { title: 'Czas przetrzymania ścieków t [h]', range:[3,24], autorange:false },
      margin: { l: 60, r: 60, t: 10, b: 55 }
    };

    const config = { displayModeBar:false, responsive:true, doubleClick:'reset' };
	Plotly.newPlot('cnt', [contour, pointTrace], layout, config).then(resizeSquare);

    document.getElementById('btn').addEventListener('click', () => {
      const t = parseFloat(document.getElementById('t').value);
      const T = parseFloat(document.getElementById('T').value);
      const wynikElem = document.getElementById('wynik');
      wynikElem.classList.remove('big', 'small');

      if (isNaN(t) || isNaN(T)) {
        wynikElem.textContent = 'Uzupełnij obie wartości.';
        wynikElem.classList.add('small');
        Plotly.restyle('cnt', { x: [[]], y: [[]], text: [[]] }, [1]);
        return;
      }
      if (t < 3 || t > 24 || T < 10 || T > 25) {
	wynikElem.innerHTML = 'Należy wybrać wartości z zakresów:<br>Czas przetrzymania: 3–24 h,<br>Temperatura: 10–25 °C.';
	wynikElem.classList.add('small');

        Plotly.restyle('cnt', { x: [[]], y: [[]], text: [[]] }, [1]);
        return;
      }

      let val = model(t, T);
      const capped = val > 1000;
      const textVal = capped ? '>1000 ppm' : `${val.toFixed(2)} ppm`;
      wynikElem.textContent = textVal;
      wynikElem.classList.add('big');

      Plotly.restyle('cnt', { x: [[T]], y: [[t]], text: [[textVal]] }, [1]);
    });

    document.getElementById('dl').addEventListener('click', async () => {
      const url = await Plotly.toImage('cnt', {format:'png', width:900, height:620, scale:2});
      const aEl = document.createElement('a');
      aEl.href = url; aEl.download = 'mapa_konturowa_H2S.png';
      document.body.appendChild(aEl); aEl.click(); aEl.remove();
    });

    document.getElementById('resetViewBtn').addEventListener('click', () => {
      Plotly.relayout('cnt', {
        'xaxis.range': [10, 25], 'yaxis.range': [3, 24]
      });
    });
	function resizeSquare() {
	  // Jeśli ekran jest szeroki – desktop
	  if (window.innerWidth > 768) {
	    Plotly.relayout('cnt', { height: 620 });
	    return;
	  }
	
	  // Dla telefonów – kwadratowa mapa
	  const el = document.getElementById('cnt');
	  const w = el.clientWidth || el.getBoundingClientRect().width;
	  const h = Math.max(340, Math.min(520, Math.round(w * 0.92)));
	  Plotly.relayout('cnt', { height: h });
	}
	
	window.addEventListener('resize', resizeSquare);
	window.addEventListener('load', resizeSquare); // wywołaj przy starcie

  </script>
</body>
</html>










